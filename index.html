<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Spagbol Roster</title>
		<link type="text/css" href="jqueryui/css/ui-lightness/jquery-ui-1.8.13.custom.css" rel="stylesheet" />	
		<script type="text/javascript" src="jqueryui/js/jquery-1.5.1.min.js"></script>
		<script type="text/javascript" src="jqueryui/js/jquery-ui-1.8.13.custom.min.js"></script>
		<script type="text/javascript">
			$(function(){
                $( "div[id^='draggable']" ).draggable({ helper: "clone" , cursor: "move" });

                $( "#weekday-monday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-tuesday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-wednesday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-thursday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-friday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-saturday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-sunday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });
                $( "#weekday-noday" ).droppable({ drop: handleDrop,
                                                   hoverClass: "ui-state-active" });

                function handleDrop( event, ui ) {
                    //Get Details of dragged and dropped
                    var cook = ui.draggable;
                    var day = $(this)

                    $(cook).detach().css({top: 0, left: 0}).appendTo(day);
                }


                function assignAllCooksToNoDay() {
                    cooks = $( "div[id^='draggable']" );

                    $.each(cooks, function(index) {
                        assignCookToDay( "noday", $(this) );
                    })
                }

                assignAllCooksToNoDay();

                loadCookingDaysFromServer();

                //var json = "{ \"monday\": \"chris\", \"tuesday\": \"zak\", \"friday\": \"nick\" }"

                function loadCookingDaysFromServer() {
                    $.ajax({
                        type: 'GET',
                        url: "/loadSchedule",
                        contentType: "application/json",
                        success: function(json) {
                                   var data = $.parseJSON(json);

                                   $.each(data, function(key, val) {
                                       cook = key
                                       day = val
                                       assignCookToDay(day, $( "#draggable-" + cook ) );
                                   });
                             }
                     });
                }

                function assignCookToDay( day, cookElement ) {
                    var dayElement = $( "#weekday-" + day );

                    cookElement.detach().css({top: 0, left: 0}).appendTo(dayElement);
                }



                $( ".save button:first" ).button({
                                             icons: { primary: "ui-icon-gear" }
                                                 }).click(saveAndNotify);

                function saveAndNotify() {
                    chrisElement = $( "#draggable-chris" );
                    chrisDay = chrisElement.parent()[0].id.split('-')[1]
                    nickElement = $( "#draggable-nick" );
                    nickDay = nickElement.parent()[0].id.split('-')[1]
                    steveElement = $( "#draggable-steve" );
                    steveDay = steveElement.parent()[0].id.split('-')[1]
                    zakElement = $( "#draggable-zak" );
                    zakDay = zakElement.parent()[0].id.split('-')[1]

                    dataObj = { "chris":chrisDay, "nick":nickDay, "steve":steveDay, "zak":zakDay };

                    $.ajax({
                        type: 'PUT',
                        url: "/saveSchedule",
                        data: JSON.stringify(dataObj),
                        contentType: "application/json",
                        success: function(data){  
                            },
                        complete: function(){ 
                            }
                        });
                }

                function saveSuccessCallback(response) {
                    alert(response);
                }

			});
		</script>
		<style type="text/css">
			/*demo page css*/
			body{ font: 62.5% "Trebuchet MS", sans-serif; margin: 50px;}
			.demoHeaders { margin-top: 2em; }

            /* Droppable */
            .draggable { width: 90px; height: 30px; padding: 0.5em; text-align: center; float: left; cursor: move; margin: 10px 10px 10px 0; }

            #weekdays { float: left; width: 100%; min-height: 12em; } * html #gallery { height: 12em; } /* IE6 */
            .weekdays li { float: left; width: 100px; height: 150px; padding: 0.4em; margin: 0 0.4em 0.4em 0; text-align: center; }

            #weekday-noday { float: left; width: 150px; height: 250px; padding: 0.4em; margin: 5em 0.4em 0.4em 0; text-align: center; }

            #draggable-chris { background: LightSalmon }
            #draggable-nick { background: PaleVioletRed }
            #draggable-steve { background: DeepSkyBlue }
            #draggable-zak { background: #0dd }

            button { float: right; width: 200px; height: 30px; margin: 2em 0 2em 1em; }

		</style>	
	</head>
	<body>
	<h1>Welcome to Spagbol Roster!</h1>

    <div class="ui-widget ui-helper-clearfix">
      <ul id="weekdays" class="weekdays ui-helper-reset ui-helper-clearfix">
        <li id="weekday-monday" class="droppable ui-widget-content">Monday</li>
        <li id="weekday-tuesday" class="droppable ui-widget-content">Tuesday</li>
        <li id="weekday-wednesday" class="droppable ui-widget-content">Wednesday</li>
        <li id="weekday-thursday" class="droppable ui-widget-content">Thursday</li>
        <li id="weekday-friday" class="droppable ui-widget-content">Friday</li>
        <li id="weekday-saturday" class="droppable ui-widget-content">Saturday</li>
        <li id="weekday-sunday" class="droppable ui-widget-content">Sunday</li>
      </ul>
      <div class="save"><button>Save & Notify</button></div>
      <div id="weekday-noday" class="ui-widget-content">Not Cooking</div>
    </div>

    <div id="draggable-chris" class="draggable ui-widget-content ui-corner-all"><p>Chris</p></div>
    <div id="draggable-nick" class="draggable ui-widget-content ui-corner-all"><p>Nick</p></div>
    <div id="draggable-steve" class="draggable ui-widget-content ui-corner-all"><p>Steve</p></div>
    <div id="draggable-zak" class="draggable ui-widget-content ui-corner-all"><p>Zak</p></div>

    <p></p>
    <p/>
    <div/>
    <div/>
		<!-- Highlight / Error -->
		<h2 class="demoHeaders">Highlight / Error</h2>
		<div class="ui-widget">
			<div class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0 .7em;"> 
				<p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
				<strong>Woah!</strong> Don't forget to click save & notify when you're happy.</p>
			</div>
		</div>
		<br/>
		<div class="ui-widget">
			<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"> 
				<p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 
				<strong>Umm.</strong> We all make mistakes?</p>
			</div>
		</div>

	</body>
</html>


